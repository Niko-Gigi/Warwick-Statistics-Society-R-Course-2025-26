---
title: "Control structures"
format: 
  html:
    fig-width: 12
    fig-height: 6
    code-fold: show
    code-tools: true
    code-block-bg: true
    code-block-border-left: "#31BAE9"
    toc: true
    code-copy: true
    number_sections: true
    echo: fenced
---

Control structures allow us to influence the order in which lines of code are executed. It allows for repetition and conditional arguments and more.

The main 2 are:

<div>

-   Conditional:
    -   if()
    -   if() else()
-   Repeat:
    -   for()
    -   while()

</div>

These are not always efficient as they can take a relatively long processing time compared to other code. However, for now, do not worry about computation time.

# If statements

The code of code after an if statement is only executed if the condition within the if statement is met. 

```{mermaid}
%%| echo: false

flowchart LR
  A{statement A} --> B[Do this if true.]
  A --> C[Do nothing.]
```

For example, we can check 'if 5 $<$ 7' and ask the computer to output "Hello world." if it is true. 

```{r}
###| Example of if()
if (5<7) {
  print("Hello world.")
}
```

Moreover, we can add an additional condition. If 'if 5 $<$ 7' is false, we can specify what we would like the computer to do instead using an `else()` command. (In this case, we output "It.". )

```{r}
###| Example of if() and else()
if (5 > 7) {
  print("Not it.")
} else {
    print("It.")
}
```

Now, our flow diagram looks like this.

```{mermaid}
%%| echo: false

flowchart LR
  A{statement A} --> B[Do X if true.]
  A --> C[Do Y if false]
```
:::{.callout-important}
We can nest if statements inside of each other. 
:::

One such example is the following function that checks if a number is a multiple of $2$, $3$, $5$ or $7$.

```{r}
###| Nested if statement example

# Function to check divisibility by 2, 3, 5, or 7
check_divisibility <- function(num) {
  # Ensure the input is numeric
  if (!is.numeric(num)) {
    return("Please provide a numeric input.")
  }
  
  # Check divisibility by 2
  if (num %% 2 == 0) {
    return("The number is divisible by 2.")
  } else if (num %% 3 == 0) { # Check divisibility by 3
    return("The number is divisible by 3.")
  } else if (num %% 5 == 0) { # Check divisibility by 5
    return("The number is divisible by 5.")
  } else if (num %% 7 == 0) { # Check divisibility by 7
    return("The number is divisible by 7.")
  } else { # If none of the above conditions are true
    return("The number is not divisible by 2, 3, 5, or 7.")
  }
}

# Example usage:
check_divisibility(14) # Output: "The number is divisible by 2."
check_divisibility(21) # Output: "The number is divisible by 3."
check_divisibility(25) # Output: "The number is divisible by 5."
check_divisibility(49) # Output: "The number is divisible by 7."
check_divisibility(11) # Output: "The number is not divisible by 2, 3, 5, or 7."
```
The following illustrates this as a flow diagram: 

```{mermaid}
%%| echo: false

graph TD
    A[Start] --> B{Is input numeric?}
    B -- No --> C["Please provide a numeric input."]
    B -- Yes --> D{Is the number divisible by 2?}
    D -- Yes --> E["The number is divisible by 2."]
    D -- No --> F{Is the number divisible by 3?}
    F -- Yes --> G["The number is divisible by 3."]
    F -- No --> H{Is the number divisible by 5?}
    H -- Yes --> I["The number is divisible by 5."]
    H -- No --> J{Is the number divisible by 7?}
    J -- Yes --> K["The number is divisible by 7."]
    J -- No --> L["The number is not divisible by 2, 3, 5, or 7."]
```

In this instance, we can stop when we find the smallest number that is a factor of the input. However, we may want to check every case. 

# For loops

The for loop allows code to be executed repeatedly until a given iteration.

```{mermaid}
%%| echo: false

graph TD
    A[Start] --> B[Initialize loop variable]
    B --> C{Condition met?}
    C -- No --> D[Exit loop]
    C -- Yes --> E[Execute loop body]
    E --> F[Update loop variable]
    F --> C
    D --> G[End]
```

Suppose we want to print the numbers 1, 2, 3 and 4. We can use a for loop for this:

```{r}
###| For loop example
for (x in c(1:4)) {
  print(x)
}
```

:::{.callout-important}
R will automatically increase the counter. We do not need to include `x<-x+1` as we do in Python.
:::

Alternatively, suppose we wanted to print the number 1, then the numbers 1 to 3, then the number 2, then 1 to 3 again, then 3 ... . We can use nested for loops for this:

```{r}
###| Nested loop
for (x in c(1:4)) {
  print(x)
  for (y in c(1:3)) {
    print(y)
  }
}
```

# While loops

While loop tests if a condition is true and will continue running the code until the condition is false.

```{mermaid}
%%| echo: false

graph TD
    A[Start] --> B{Condition met?}
    B -- No --> C[Exit loop]
    B -- Yes --> D[Execute loop body]
    D --> B
    C --> E[End]
```

:::{.callout-important}
It is very important to avoid infinite loops!!
:::

```{r}
###| While loop example
i <- 1
while (i <= 5){
  print(i)
  i <- i + 1
}
```

# Example combining if, for and while loops

```{r}
# Initialize variables
x <- 1    # Start value for while loop
results <- c()  # Empty vector to store results

# While loop: Run while x is less than or equal to 10
while (x <= 10) {
  # For loop: Iterate through numbers 1 to 5
  for (y in 1:5) {
    # If statement: Check if the product of x and y is even
    if ((x * y) %% 2 == 0) {
      # Add the product to the results vector if even
      results <- c(results, x * y)
    }
  }
  # Increment x to avoid infinite loop
  x <- x + 1
}

# Print the results
print("Results of even products:")
print(results)
```

# Check your understanding

Answer the following questions using if(), for() and while() loops.

<div>

-   Given a number, print "Positive" or "Negative" depending on if the number is positive or negative. If the number is 0, print both.
-   Given a vector, find the maximum and minimum value. Thus find out the range.

</div>

```{r}
#| code-fold: true
###| Answers
x=-1
if (x > 0) {
  print("positive")
} else if (x < 0) {
  print("negative")
} else {print("both")}
```

```{r}
#| code-fold: true
###| Answers
x <- c(0,1,2,7,-5)
n <- length(x)
min <- x[1]
max <- x[1]

for(i in 1:n){
  if (x[i] < min) {
    min <- x[i]
  }
  if (x[i] > max) {
    max <- x[i]
  }
}

print(paste("Range is",max-min))
```
